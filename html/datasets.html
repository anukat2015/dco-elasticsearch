<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Dataset Browser</title>

    <script type="text/javascript" src="facetview2/vendor/jquery/1.7.1/jquery-1.7.1.min.js"></script>
    <link rel="stylesheet" href="facetview2/vendor/bootstrap/css/bootstrap.min.css">
    <script type="text/javascript" src="facetview2/vendor/bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="facetview2/vendor/jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.css">
    <script type="text/javascript" src="facetview2/vendor/jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.min.js"></script>

    <script type="text/javascript" src="facetview2/es.js"></script>
    <script type="text/javascript" src="facetview2/bootstrap2.facetview.theme.js"></script>
    <script type="text/javascript" src="facetview2/jquery.facetview2.js"></script>
    <link rel="stylesheet" href="facetview2/css/facetview.css">
    <link rel="stylesheet" href="browsers.css">

    <!--<script type="text/javascript" src="/vivo/themes/dco/js/facetview2/vendor/jquery/1.7.1/jquery-1.7.1.min.js"></script>-->
    <!--<link rel="stylesheet" href="/vivo/themes/dco/js/facetview2/vendor/bootstrap/css/bootstrap.min.css">-->
    <!--<script type="text/javascript" src="/vivo/themes/dco/js/facetview2/vendor/bootstrap/js/bootstrap.min.js"></script>-->
    <!--<link rel="stylesheet" href="/vivo/themes/dco/js/facetview2/vendor/jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.css">-->
    <!--<script type="text/javascript" src="/vivo/themes/dco/js/facetview2/vendor/jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.min.js"></script>-->

    <!--<script type="text/javascript" src="/vivo/themes/dco/js/facetview2/es.js"></script>-->
    <!--<script type="text/javascript" src="/vivo/themes/dco/js/facetview2/bootstrap2.facetview.theme.js"></script>-->
    <!--<script type="text/javascript" src="/vivo/themes/dco/js/facetview2/jquery.facetview2.js"></script>-->
    <!--<link rel="stylesheet" href="/vivo/themes/dco/js/facetview2/css/facetview.css">-->
    <!--<link rel="stylesheet" href="/vivo/themes/dco/css/browsers.css">-->


    <script type="text/javascript">
        jQuery(document).ready(function($) {
            $('.facet-view-simple').facetview({
//                search_url: '//localhost:9200/dco/dataset/_search',
                search_url: '//dcotest.tw.rpi.edu/search/dco/dataset/_search',
                page_size: 20,
                sort: [
                    {"_score" : {"order" : "asc"}},
                    {"publicationYear" : {"order" : "desc"}},
                    {"title" : {"order" : "asc"}}
                ],
                sharesave_link: true,
                search_button: true,
                default_freetext_fuzzify: "*",
                default_facet_operator: "AND",
                default_facet_order: "count",
                default_facet_size: 15,
                facets: [
                    {'field': 'mostSpecificType', 'display': 'Type'},
                    {'field': 'publicationYear', 'display': 'Publication Year'},
                    {'field': 'authors.name.exact', 'size': 20, 'display': 'Author'},
                    {'field': 'authors.organization.name.exact', 'display': 'Author Organization'},
                    {'field': 'dcoCommunities.name.exact', 'display': 'DCO Communities'},
                    {'field': 'portalGroups.name.exact', 'display': 'Portal Group'},
                    {'field': 'projects.name.exact', 'display': 'Project'},
                    {'field': 'dataTypes.name.exact', 'display': 'Data Type'}
//                    {'field': 'isDcoPublication', 'display': 'Show only DCO-member authored publications'}
                ],
                search_sortby: [
                    {'display':'Date','field':'publicationYear'},
                    {'display':'Title','field':'title'}
                ],
                render_result_record: function(options, record)
                {

                    var doiUrl = "https://dx.doi.org/"+record["doi"];

                    var html = "<tr><td>";

                    if (record["isDcoPublication"]) {
                        html += "<img style='vertical-align: middle' src='//deepcarbon.net/sites/default/files/images/dco-icon-footer_0.png' height='15' width='15'>&nbsp;";
                    }

                    if (record["doi"]) {
                        html += "<strong><a href=\""+doiUrl+"\" target=\"_blank\">" + record["title"] + "</a></strong>";
                    } else {
                        html += "<strong>" + record["title"] + "</strong>";
                    }

                    if (record["publicationYear"]) {
                        html += "&emsp;<small>(" + record["publicationYear"] + ")</small>";
                    }

                    if (record["mostSpecificType"]) {
                        html += "<br />Type: " + record["mostSpecificType"];
                    }

                    if (record["dcoId"]){
                        var dcoIdString = decodeURIComponent(encodeURIComponent(record["dcoId"].substring(25)));
                        html += '<br /><span>DCO-ID: <a href=\"' + record["dcoId"] + '\" target="_black\">' + dcoIdString + "</a></span>";
                    }

                    if (record["dcoCommunities"]) {
                        html += "<br /><span><small>DCO Communites: ";
                        if (record["dcoCommunities"].length == 0) {
                            html += 'N/A'
                        } else {
                            for (var i = 0; i < record["dcoCommunities"].length; i++) {
                                html += "<a href=\"" + record["dcoCommunities"][i]["uri"] + "\" target=\"_blank\">" + record["dcoCommunities"][i]["name"] + "</a>";
                                if (i < record["dcoCommunities"].length - 1) {
                                    html += "; ";
                                }
                            }
                        }
                        html += "</small></span>";
                    }

                    if (record["portalGroups"]) {
                        html += "<br /><span><small>DCO Portal Groups: ";
                        if (record["portalGroups"].length == 0) {
                            html += 'N/A'
                        } else {
                            for (var i = 0; i < record["portalGroups"].length; i++) {
                                html += "<a href=\"" + record["portalGroups"][i]["uri"] + "\" target=\"_blank\">" + record["portalGroups"][i]["name"] + "</a>";
                                if (i < record["portalGroups"].length - 1) {
                                    html += "; ";
                                }
                            }
                        }
                        html += "</small></span>";
                    }

                    if (record["authors"]) {
                        html += "<br /><span><small>Authors: ";
                        if (record["authors"].length == 0) {
                            html += 'N/A'
                        } else {
                            for (var i = 0; i < record["authors"].length; i++) {
                                html += "<a href=\"" + record["authors"][i]["uri"] + "\" target=\"_blank\">" + record["authors"][i]["name"] + "</a>";
                                if (i < record["authors"].length - 1) {
                                    html += "; ";
                                }
                            }
                        }
                        html += "</small></span>";
                    }

                    if (record["projects"]) {
                        html += "<br /><span><small>Projects: ";
                        if (record["projects"].length == 0) {
                            html += 'N/A'
                        } else {
                            for (var i = 0; i < record["projects"].length; i++) {
                                html += "<a href=\"" + record["projects"][i]["uri"] + "\" target=\"_blank\">" + record["projects"][i]["name"] + "</a>";
                                if (i < record["projects"].length - 1) {
                                    html += "; ";
                                }
                            }
                        }
                        html += "</small></span>";
                    }

                    if (record["dataTypes"]) {
                        html += "<br /><span><small>Has Data Types: ";
                        if (record["dataTypes"].length == 0) {
                            html += 'N/A'
                        } else {
                            for (var i = 0; i < record["dataTypes"].length; i++) {
                                html += "<a href=\"" + record["dataTypes"][i]["uri"] + "\" target=\"_blank\">" + record["dataTypes"][i]["name"] + "</a>";
                                if (i < record["dataTypes"].length - 1) {
                                    html += "; ";
                                }
                            }
                        }
                        html += "</small></span>";
                    }

                    if (record["citations"]) {
                        html += "<br /><span><small>Citations (Source Papers): ";
                        if (record["citations"].length == 0) {
                            html += 'N/A'
                        } else {
                            for (var i = 0; i < record["citations"].length; i++) {
                                html += "<a href=\"" + record["citations"][i]["uri"] + "\" target=\"_blank\">" + record["citations"][i]["name"] + "</a>";
                                if (i < record["citations"].length - 1) {
                                    html += "; ";
                                }
                            }
                        }
                        html += "</small></span>";
                    }

                    if (record["distributions"]) {
                        html += "<br /><span><small>Distributions: ";
                        if (record["distributions"].length == 0) {
                            html += 'N/A'
                        } else {
                            html += "<br /> &emsp;&emsp;&emsp;&emsp;";
                            for (var i = 0; i < record["distributions"].length; i++) {
                                html += ("<a href=\"" + record["distributions"][i]["accessURL"] + "\" target=\"_blank\">"
                                        + record["distributions"][i]["name"] + "</a>");
                                html += " (Direct access: ";
                                for (var j = 0; j < record["distributions"][i]["files"].length; j++){
                                    html += ("<a href=\"" + record["distributions"][i]["files"][j]["downloadURL"]
                                            + "\" target=\"_blank\">"
                                            + record["distributions"][i]["files"][j]["name"] + "</a>");
                                    if (j < record["distributions"][i]["files"].length - 1) {
                                        html += "; ";
                                    }
                                }
                                html += ")";
                                if (i < record["distributions"].length - 1) {
                                    html += "; <br /> &emsp;&emsp;&emsp;&emsp;";
                                }
                            }
                        }
                        html += "</small></span>";
                    }

                    // abstract??

                    // Badges

                    html += "<br />";

                    if (record["doi"]) {
                        var escapedDOI = encodeURIComponent(record["doi"]);
                        html += "<a href=\"" + doiUrl + "\" target=\"_blank\"><img style='vertical-align: middle' src='//dcotest.tw.rpi.edu/badges/badge?title=DOI&text="+escapedDOI+"&color=66CCFF'/></a>&emsp;";
                    }

                    var escapedDCOId= encodeURIComponent(record["dcoId"].substring(25));
                    html += "<a href=\""+record["dcoId"]+"\" target=\"_blank\"><img style='vertical-align: middle' src='//dcotest.tw.rpi.edu/badges/badge?title=metadata&text="+escapedDCOId+"&color=D14719'/></a>";

                    html += "</td></tr>";
                    return html;
                },
                selected_filters_in_facet: true,
                show_filter_field : true,
                show_filter_logic: true/*,
                post_init_callback: function(options, context) {
                    // on initial load activate the isDcoPublication filter
                    options.active_filters = {'isDcoPublication': ['T']};

                    // add the 'dco publication' checkbox to the UI
                    $(".facetview_search_options_container")
                            .after("<input id='is-dco-publication-checkbox' type='checkbox'>&nbsp;Only show contributions to the DCO</input>&nbsp;<img style='vertical-align: middle' src='//deepcarbon.net/sites/default/files/images/dco-icon-footer_0.png' height='15' width='15'>");

                    // set checkbox to control isDcoPublication filter on selection/deselection
                    $("#is-dco-publication-checkbox")
                            .change(function() {
                                if(this.checked) {
                                    $("a.facetview_filterchoice[data-field='isDcoPublication'][data-value='T']").click();
                                } else {

                                    $("a.facetview_clear[data-field='isDcoPublication'][data-value='T']").click();
                                }
                            });
                },
                post_render_callback: function(options, context) {
                    if(options.active_filters["isDcoPublication"] != null) {
                        // if the isDcoPublication filter is active set ensure the checkbox is checked
                        $("#is-dco-publication-checkbox").attr("checked", true);
                    } else if (!$("a.facetview_filterchoice[data-field='isDcoPublication'][data-value='T']").length) {
                        // if the isDcoPublication filter is not active and is not a valid option
                        // (there are no remaining DCO publications in the result set) then disable the checkbox
                        $("#is-dco-publication-checkbox").attr("disabled", true);
                    } else {
                        // if the isDcoPublication filter is not active is a valid option ensure it is enabled
                        $("#is-dco-publication-checkbox").attr("disabled", false);
                    }
                }
                */
            });
        });

    </script>


    <style type="text/css">
        .facet-view-simple{
            width:100%;
            height:100%;
            margin:20px auto 0 auto;
        }

        .facetview_freetext.span4 {
           width: 290px;
           height: 12px;
        }

        legend {
            display: none;
        }

        #wrapper-content {
          padding-top: 0px;
        }

        input {
            -webkit-box-shadow: none;
            box-shadow: none;
        }

    </style>

</head>
<body>
<div class="facet-view-simple"></div>
</body>
</html>
